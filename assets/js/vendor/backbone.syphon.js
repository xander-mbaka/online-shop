Backbone.Syphon=function(e,t,n){var r={};r.ignoredTypes=["button","submit","reset","fieldset"],r.serialize=function(e,r){var a={},y=s(r),p=o(e,y);return n.each(p,function(e){var n=t(e),r=i(n),o=y.keyExtractors.get(r),s=o(n),p=y.inputReaders.get(r),u=p(n),d=y.keyAssignmentValidators.get(r);if(d(n,s,u)){var h=y.keySplitter(s);a=c(a,h,u)}}),a},r.deserialize=function(e,r,a){var c=s(a),p=o(e,c),u=y(c,r);n.each(p,function(e){var n=t(e),r=i(n),o=c.keyExtractors.get(r),a=o(n),s=c.inputWriters.get(r),y=u[a];s(n,y)})};var o=function(e,r){var o=a(e),s=o.elements;return s=n.reject(s,function(e){var o,a=i(e),s=r.keyExtractors.get(a),c=s(t(e)),y=n.include(r.ignoredTypes,a),p=n.include(r.include,c),u=n.include(r.exclude,c);return o=p?!1:r.include?!0:u||y})},i=function(e){var n,r=t(e),o=r[0].tagName,i=o;return"input"===o.toLowerCase()&&(n=r.attr("type"),i=n?n:"text"),i.toLowerCase()},a=function(e){return n.isUndefined(e.$el)&&"form"===e.tagName.toLowerCase()?e:e.$el.is("form")?e.el:e.$("form")[0]},s=function(e){var t=n.clone(e)||{};return t.ignoredTypes=n.clone(r.ignoredTypes),t.inputReaders=t.inputReaders||r.InputReaders,t.inputWriters=t.inputWriters||r.InputWriters,t.keyExtractors=t.keyExtractors||r.KeyExtractors,t.keySplitter=t.keySplitter||r.KeySplitter,t.keyJoiner=t.keyJoiner||r.KeyJoiner,t.keyAssignmentValidators=t.keyAssignmentValidators||r.KeyAssignmentValidators,t},c=function(e,t,r){if(!t)return e;var o=t.shift();return e[o]||(e[o]=n.isArray(o)?[]:{}),0===t.length&&(n.isArray(e[o])?e[o].push(r):e[o]=r),t.length>0&&c(e[o],t,r),e},y=function(e,t,r){var o={};return n.each(t,function(t,i){var a={};r&&(i=e.keyJoiner(r,i)),n.isArray(t)?(i+="[]",a[i]=t):n.isObject(t)?a=y(e,t,i):a[i]=t,n.extend(o,a)}),o};return r}(Backbone,jQuery,_),Backbone.Syphon.TypeRegistry=function(){this.registeredTypes={}},Backbone.Syphon.TypeRegistry.extend=Backbone.Model.extend,_.extend(Backbone.Syphon.TypeRegistry.prototype,{get:function(e){var t=this.registeredTypes[e];return t||(t=this.registeredTypes["default"]),t},register:function(e,t){this.registeredTypes[e]=t},registerDefault:function(e){this.registeredTypes["default"]=e},unregister:function(e){this.registeredTypes[e]&&delete this.registeredTypes[e]}}),Backbone.Syphon.KeyExtractorSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.KeyExtractors=new Backbone.Syphon.KeyExtractorSet,Backbone.Syphon.KeyExtractors.registerDefault(function(e){return e.prop("name")}),Backbone.Syphon.InputReaderSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.InputReaders=new Backbone.Syphon.InputReaderSet,Backbone.Syphon.InputReaders.registerDefault(function(e){return e.val()}),Backbone.Syphon.InputReaders.register("checkbox",function(e){var t=e.prop("checked");return t}),Backbone.Syphon.InputWriterSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.InputWriters=new Backbone.Syphon.InputWriterSet,Backbone.Syphon.InputWriters.registerDefault(function(e,t){e.val(t)}),Backbone.Syphon.InputWriters.register("checkbox",function(e,t){e.prop("checked",t)}),Backbone.Syphon.InputWriters.register("radio",function(e,t){e.prop("checked",e.val()===t)}),Backbone.Syphon.KeyAssignmentValidatorSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.KeyAssignmentValidators=new Backbone.Syphon.KeyAssignmentValidatorSet,Backbone.Syphon.KeyAssignmentValidators.registerDefault(function(){return!0}),Backbone.Syphon.KeyAssignmentValidators.register("radio",function(e){return e.prop("checked")}),Backbone.Syphon.KeySplitter=function(e){var t=e.match(/[^\[\]]+/g);return e.indexOf("[]")===e.length-2&&(lastKey=t.pop(),t.push([lastKey])),t},Backbone.Syphon.KeyJoiner=function(e,t){return e+"["+t+"]"};